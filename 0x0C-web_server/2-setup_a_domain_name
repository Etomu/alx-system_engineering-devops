#!/usr/bin/env bash

# Replace example.com with your own domain name
DOMAIN_NAME=TTobin.tech

# Replace WEB_SERVER_IP_ADDRESS with the IP address of your web-01 server
WEB_SERVER_IP_ADDRESS=3.238.228.31

# Configure A record for domain name
echo "Configuring DNS for ${TTobin.tech}..."
curl -X PATCH "https://api.dnsimple.com/v2/registrations/${DOMAIN_NAME}/records" \
     -H "Authorization: Bearer <YOUR_API_TOKEN>" \
     -H "Content-Type: application/json" \
     -d "{\"data\":\"${3.238.228.31}\",\"name\":\"@\",\"type\":\"A\",\"ttl\":3600}"

# Wait for DNS propagation
echo "Waiting for DNS propagation..."
sleep 7200

# Verify domain registrar
REGISTRAR_NAME=$(curl -s "https://whois.whoisxmlapi.com/whoisserver/WhoisService?apiKey=<YOUR_API_KEY>&domainName=${TTobin.tech}" | jq -r '.WhoisRecord.registrarName')
if [ "$REGISTRAR_NAME" = "Dotserve Inc" ]; then
    echo "Domain registrar verified: ${REGISTRAR_NAME}"
else
    echo "Error: Domain registrar not verified"
    exit 1
fi

# Write domain name to file
echo "${TTobin}" > 2-setup_a_domain_name

echo "Done!"
